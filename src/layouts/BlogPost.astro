---
import type { CollectionEntry } from "astro:content";
import { Separator } from "@/components/ui/separator";
import Layout from "@/layouts/Layout.astro";
import Section from "@/components/Section.astro";
import Author from "@/components/Author.astro";
import Container from "@/components/Container.astro";
import Date from "@/components/Date.astro";
import { getEntry } from "astro:content";
import { Image } from "astro:assets";
import { Badge } from "@/components/ui/badge";

type Props = CollectionEntry<"blog">["data"];

const {
  title,
  description,
  publishedAt,
  tags,
  image,
  author: { id: author_id },
} = Astro.props;

const author = await getEntry("authors", author_id);
---

<Layout title={title} description={description}>
  <!-- Image -->
  <Section>
    <Container class="p-0">
      {
        image && (
          <Image
            src={image.src}
            alt={image.alt}
            width={1200}
            height={630}
            class="col-span-full mx-auto w-full max-w-[1000px] object-cover"
          />
        )
      }
    </Container>
  </Section>

  <!-- Header -->
  <Section as="header">
    <Container>
      <div class="text-xs font-mono flex gap-x-2 items-center">
        <Date date={publishedAt} />
        <Separator orientation="vertical" className="h-4" />
        <Author {...author.data} />
        <!-- TODO: reading time estimate ? -->
      </div>
      <h1 class="text-4xl pt-2 pb-4">{title}</h1>
      <div class="flex gap-x-1">
        {
          tags?.map((t: string) => (
            <Badge
              className="rounded-none px-1 font-normal text-xs"
              variant="outline"
            >
              #{t}
            </Badge>
          ))
        }
      </div>
    </Container>
  </Section>
  <Section as="article">
    <Container>
      <slot />
    </Container>
  </Section>
</Layout>
